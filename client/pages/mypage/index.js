import Head from 'next/head'
import React,  { useState, useEffect } from 'react';
import { Col, Row, Card, Alert, Navbar, Nav, Container, Offcanvas, Image } from 'react-bootstrap';
import Link from 'next/link'
//import { useRouter } from 'next/navigation'
import 'bootstrap/dist/css/bootstrap.min.css';
import { withProtected } from '../../src/app/routes';



function myPage( {auth} ) {

  const [ error, setError ] = useState('');
  const { currentUser, logOut } = auth;
  const [ userInfo, setUserInfo ] = useState('');
 
  useEffect(() => {
    const loadUserInfo = async () => {
      const token = await currentUser.getIdToken();
      console.log(token)
      /*
      const res = await axios.get('/users/${currentUser.uid}', {
        headers: { authtoken: token }
      });
      setUserInfo(res.data)
      */
    }
    if (currentUser) {
      loadUserInfo();
    }
  }, [currentUser]);

  console.log("mypage")
  console.log(currentUser)
  async function handleLogOut() {
  
    try {

      setError("")
      await logOut();
    } catch {

      setError("Failed to Log Out")

    }
  }
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {[false].map((expand) => (
        <Navbar key={expand} bg="dark" variant="dark" expand={expand} className="mb-3">
          <Container fluid>
          <Navbar.Brand href="/">Dog Transportation</Navbar.Brand>
            <Navbar.Toggle aria-controls={`offcanvasNavbar-expand-${expand}`} />
            <Navbar.Offcanvas
              id={`offcanvasNavbar-expand-${expand}`}
              aria-labelledby={`offcanvasNavbarLabel-expand-${expand}`}
              placement="end"
            >
              <Offcanvas.Header closeButton>
                <Offcanvas.Title id={`offcanvasNavbarLabel-expand-${expand}`}>
                { currentUser && <div>{currentUser.displayName? currentUser.displayName: currentUser.email}</div> }
                </Offcanvas.Title>
              </Offcanvas.Header>
              <Offcanvas.Body>
                <Nav className="justify-content-end flex-grow-1 pe-3">
                  <Nav.Link href="/mypage">View my page</Nav.Link>
                  <Nav.Link href="/mydogs">Manage my dogs</Nav.Link>
                  <Nav.Link href="../message">My Message</Nav.Link>
                  <Nav.Item> 
                    <Nav.Link onClick = { handleLogOut }>Log Out</Nav.Link>
                  </Nav.Item>
                </Nav>
              </Offcanvas.Body>
            </Navbar.Offcanvas>
          </Container>
        </Navbar>
      ))}
      <Container style = {{ minHeight: "20vh" }}>
      <div className = "w-100" style = {{ maxWidth: '400px'}}></div>
      <div>
        <Row>
          <Col xs={6} md={3}>
            <Row>
            <Image
                  style={{ height: '10rem'  }}
                  className="d-block w-100"
                  src="http://localhost:3000/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fdog_9.77c974bd.jpeg&w=640&q=75"
                  roundedCircle 
                />
            </Row>
            <Row>
            <Link href = '/profile' className = 'profile-update'>update profile</Link>
            </Row>
          </Col>
          <Col xs={6} md={8}>
            <h2> { currentUser && <div>{currentUser.displayName? currentUser.displayName: currentUser.email}'s page</div> } </h2>
          </Col>
        </Row>
      </div>
      </Container>
      
      <Container style = {{ minHeight: "100vh" }}>
      <div className = "w-300" style = {{ maxWidth: '400px'}}>
        <h3>My Dogs</h3>
        <Link href= "../admin" className="btn btn-primary w-500 mt-3">
          go upload my dogs  
        </Link>
        <Link href= "../mydogs" className="btn btn-primary w-500 mt-3">
          go manage my dogs  
        </Link>
      </div>
      </Container>  
    </>
   
  )
}

export default withProtected(myPage)
